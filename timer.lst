C51 COMPILER V9.60.0.0   TIMER                                                             12/27/2023 11:38:56 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\hex\timer.obj
COMPILER INVOKED BY: C:\Keil_C51\C51\BIN\C51.EXE Source\timer.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\timer.lst) TABS(2) OBJECT(.\hex\timer.obj)

line level    source

   1          
   2          #include "main.h"
   3          
   4          //-----------------------------------------------
   5          
   6          #define FOSC 11059200L
   7          #define T0MS (65536 - FOSC / 1015) // 1T模式   +快些  -慢些  1005
   8          // #define T2MS (65536 - FOSC / 1000) // 1T模式
   9          
  10          #define TIME_BASE_10MS 10
  11          u8 time_base_10ms = 10;
  12          //-----------------------------------------------
  13          
  14          /* Timer0 interrupt routine */
  15          void tm0_isr() interrupt 1
  16          {
  17   1      
  18   1        --time_base_10ms;
  19   1        if (time_base_10ms == 0)
  20   1        {
  21   2          time_base_10ms = TIME_BASE_10MS;
  22   2      
  23   2          Key_Scan_Cnt = 1; // 定时器变量10ms执行一次
  24   2          ntc.Tick++;
  25   2          // if (ntc_cnt > 0) //
  26   2          //  --ntc_cnt;
  27   2        }
  28   1      
  29   1        ntc.T0_CNT++;
  30   1        if (ntc.T0_CNT > 1000)
  31   1        {
  32   2          ntc.T0_CNT = 0;
  33   2      
  34   2          ntc.Second++;
  35   2      
  36   2          led = ~led;
  37   2          if (ntc.Second > 60)
  38   2          {
  39   3            ntc.Second = 0;
  40   3            ntc.Min++;
  41   3            if (ntc.Min > 60)
  42   3            {
  43   4              ntc.Min = 0;
  44   4              ntc.Hour++;
  45   4              if (ntc.Hour > 24)
  46   4              {
  47   5                ntc.Hour = 0;
  48   5              }
  49   4            }
  50   3          }
  51   2        }
  52   1      }
  53          
  54          ////-----------------------------------------------
C51 COMPILER V9.60.0.0   TIMER                                                             12/27/2023 11:38:56 PAGE 2   

  55          ////中断服务程序
  56          // void t2int() interrupt 12           //中断入口
  57          //{
  58          ////    P10 = !P10;                     //将测试口取反
  59          ////    delay(1000);
  60          ////  IE2 &= ~0x04;                   //若需要手动清除中断标志,可先关闭中断,此时系统会自动清除内部的中断标
             -志
  61          ////  IE2 |= 0x04;                    //然后再开中断即可
  62          //}
  63          
  64          void Timer0_Init(void)
  65          {
  66   1        AUXR |= 0x80; // 定时器0为1T模式
  67   1        //  AUXR &= 0x7f;                   //定时器0为12T模式
  68   1      
  69   1        TMOD = 0x00; // 设置定时器为模式0(16位自动重装载)
  70   1        TL0 = T0MS;  // 初始化计时值
  71   1        TH0 = T0MS >> 8;
  72   1        //  TL0 = 0x3c;                     //初始化计时值
  73   1        //    TH0 = 0xb0;
  74   1        TR0 = 1; // 定时器0开始计时
  75   1        ET0 = 1; // 使能定时器0中断
  76   1        EA = 1;
  77   1      }
  78          
  79          // void Timer2_Init(void)
  80          //{
  81          //     AUXR |= 0x04;                   //定时器2为1T模式
  82          ////  AUXR &= ~0x04;                  //定时器2为12T模式
  83          //    T2L = T2MS;                     //初始化计时值
  84          //    T2H = T2MS >> 8;
  85          //    AUXR |= 0x10;                   //定时器2开始计时
  86          //
  87          //    IE2 |= 0x04;                    //开定时器2中断
  88          //    EA = 1;
  89          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    198    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
